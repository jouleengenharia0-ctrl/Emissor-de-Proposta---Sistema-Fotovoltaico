<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emissor de Proposta - Sistema Fotovoltaico</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* Estilos anteriores mantidos */
        :root {
            --primary-color: #1a5276;
            --secondary-color: #2980b9;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --rose-color: #f8d7da;
            --dark-blue: #2c3e50;
            --modern-gray: #34495e;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 15px 0;
            margin-bottom: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
        }
        
        .tabs {
            display: flex;
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .tab {
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            flex: 1;
            border-bottom: 3px solid transparent;
            font-weight: 600;
        }
        
        .tab:hover {
            background-color: var(--light-color);
        }
        
        .tab.active {
            background-color: var(--secondary-color);
            color: white;
            border-bottom: 3px solid var(--accent-color);
        }
        
        .tab-content {
            display: none;
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light-color);
        }
        
        h3 {
            color: var(--primary-color);
            margin: 20px 0 15px;
            font-size: 1.3em;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--modern-gray);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(41, 128, 185, 0.2);
        }
        
        .editable-field {
            background-color: var(--rose-color);
        }
        
        .btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .btn:hover {
            background-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .btn-danger {
            background-color: var(--accent-color);
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .btn-success {
            background-color: var(--success-color);
        }
        
        .btn-success:hover {
            background-color: #219955;
        }
        
        .btn-sm {
            padding: 5px 10px;
            font-size: 14px;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 600;
        }
        
        .result-box {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid var(--secondary-color);
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px 0;
        }
        
        .result-label {
            font-weight: 600;
            color: var(--modern-gray);
        }
        
        .result-value {
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .proposta-final {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: relative;
            width: 100%;
            max-width: 210mm; /* Largura A4 */
            margin: 0 auto;
        }
        
        .proposta-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            position: relative;
        }
        
        .proposta-logo {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .proposta-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .proposta-section {
            margin-bottom: 30px;
            position: relative;
            z-index: 2;
            page-break-inside: avoid;
        }
        
        .proposta-section h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 2px solid var(--light-color);
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--dark-blue) 100%);
            color: white;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .action-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        
        .hidden {
            display: none;
        }
        
        .valor-real {
            font-weight: bold;
            color: var(--success-color);
        }
        
        .valor-negativo {
            color: var(--accent-color);
        }
        
        .add-item-btn {
            margin-bottom: 15px;
        }
        
        .descricao-item {
            width: 50%;
        }
        
        .quantidade-item {
            width: 10%;
        }
        
        .unidade-item {
            width: 10%;
        }
        
        .preco-unitario-item {
            width: 15%;
        }
        
        .preco-total-item {
            width: 10%;
        }
        
        .acao-item {
            width: 5%;
        }
        
        table input {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
        }
        
        .watermark {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.03;
            z-index: 1;
            pointer-events: none;
        }
        
        .logo-empresa {
            position: absolute;
            top: 50px;
            right: 40px;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3;
            background: white;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            border: 3px solid var(--secondary-color);
            overflow: hidden;
        }
        
        .logo-empresa img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 12px;
        }
        
        .header-pdf {
            position: relative;
            padding: 30px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            margin-bottom: 30px;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            z-index: 2;
        }
        
        .header-pdf h1 {
            margin: 0 0 10px 0;
            font-size: 32px;
            font-weight: 800;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header-pdf p {
            margin: 5px 0;
            font-size: 16px;
            opacity: 0.95;
        }
        
        .header-content-pdf {
            max-width: 70%;
        }
        
        .modern-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 4px solid var(--secondary-color);
        }
        
        .modern-card h4 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .contact-footer {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--dark-blue) 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin-top: 30px;
            text-align: center;
        }
        
        .contact-footer h4 {
            margin-bottom: 10px;
            font-size: 1.3em;
        }
        
        .contact-info {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
        }
        
        .contact-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-geracao {
            margin-top: 10px;
            padding: 10px;
            border-radius: 6px;
            font-weight: bold;
            text-align: center;
        }
        
        .status-ok {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-alerta {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .payback-box {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            border-left: 4px solid var(--primary-color);
        }
        
        .alerta-prazo {
            background-color: #fff3cd;
            color: #856404;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            border: 1px solid #ffeaa7;
            font-size: 14px;
        }
        
        /* Estilos específicos para PDF */
        .pdf-select {
            background-color: white !important;
            border: 1px solid #ddd !important;
            color: #333 !important;
        }
        
        .pdf-page-break {
            page-break-before: always;
        }
        
        .pdf-section-1 {
            /* Primeira página - até análise de payback */
        }
        
        .pdf-section-2 {
            /* Segunda página - condições de pagamento até garantias */
            page-break-before: always;
        }
        
        .pdf-section-3 {
            /* Terceira página - materiais incluídos até o final */
            page-break-before: always;
        }

        /* Novos estilos para páginas separadas */
        .proposta-pagina {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: relative;
            width: 100%;
            max-width: 210mm; /* Largura A4 */
            margin: 0 auto 20px;
            page-break-after: always;
        }
        
        .pdf-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .pdf-controls .btn {
            margin: 5px;
        }

        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
            }
            
            .proposta-info {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1 0 50%;
            }
            
            .descricao-item, .quantidade-item, .unidade-item, .preco-unitario-item, .preco-total-item, .acao-item {
                width: auto;
            }
            
            .logo-empresa {
                width: 80px;
                height: 80px;
                top: 15px;
                right: 15px;
            }
            
            .header-content-pdf {
                max-width: 100%;
            }
            
            .contact-info {
                flex-direction: column;
                align-items: center;
            }
            
            .proposta-final {
                padding: 15px;
            }
            
            .pdf-controls {
                flex-direction: column;
                align-items: center;
            }
        }

        /* Media query para impressão/PDF */
        @media print {
            .proposta-final {
                box-shadow: none;
                padding: 0;
                margin: 0;
                width: 100%;
            }
            
            .action-buttons {
                display: none;
            }
            
            .tabs, header {
                display: none;
            }
            
            .container {
                padding: 0;
                margin: 0;
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">Emissor de Proposta - Sistema Fotovoltaico</div>
                <div class="user-info">Eng. Alexandre Gomes</div>
            </div>
        </div>
    </header>
    
    <div class="container">
        <div class="tabs">
            <div class="tab active" data-tab="info-lead">INFO LEAD</div>
            <div class="tab" data-tab="calculos">CÁLCULOS</div>
            <div class="tab" data-tab="materiais">MATERIAIS</div>
            <div class="tab" data-tab="analise-financeira">ANÁLISE FINANCEIRA</div>
            <div class="tab" data-tab="proposta-final">PROPOSTA FINAL</div>
        </div>
        
        <!-- ABA INFO LEAD -->
        <div id="info-lead" class="tab-content active">
            <h2>Informações do Lead</h2>
            
            <div class="form-group">
                <label for="data-emissao">Data:</label>
                <input type="date" id="data-emissao" class="editable-field">
            </div>
            
            <div class="form-group">
                <label for="controle">Controle:</label>
                <input type="text" id="controle" class="editable-field">
                <small>Formato: MÊSDIA-SEQUÊNCIA-GD-MIC (ex: 1110-1-GD-MIC)</small>
            </div>
            
            <h3>CLIENTE</h3>
            
            <div class="form-group">
                <label for="projeto">Projeto:</label>
                <select id="projeto" class="editable-field">
                    <option value="Comercial">Comercial</option>
                    <option value="Residencial">Residencial</option>
                    <option value="Rural">Rural</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="empreendimento">Empreendimento/Responsável:</label>
                <input type="text" id="empreendimento" class="editable-field" value="nome">
            </div>
            
            <div class="form-group">
                <label for="cpf-cnpj">CPF/CNPJ:</label>
                <input type="text" id="cpf-cnpj" class="editable-field" value="NI">
            </div>
            
            <h3>ESTADO DO PROJETO</h3>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="estado">Estado:</label>
                    <input type="text" id="estado" class="editable-field" value="PB">
                </div>
                
                <div class="form-group">
                    <label for="cidade">Cidade:</label>
                    <input type="text" id="cidade" class="editable-field" value="RECIFE">
                </div>
            </div>
            
            <h3>CONTA DE ENERGIA ELÉTRICA</h3>
            
            <div class="form-group">
                <label for="conta-contrato">Conta Contrato:</label>
                <input type="text" id="conta-contrato" class="editable-field" value="NI">
            </div>
            
            <div class="form-group">
                <label for="modalidade">Modalidade:</label>
                <select id="modalidade" class="editable-field">
                    <option value="Monofásico">Monofásico</option>
                    <option value="Trifásico">Trifásico</option>
                </select>
            </div>
            
            <h3>DADOS PARA DIMENSIONAMENTO</h3>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="consumo-medio">Consumo Médio Mensal (kWh):</label>
                    <input type="number" id="consumo-medio" class="editable-field" value="1200">
                </div>
                
                <div class="form-group">
                    <label for="percentual-aumento">Percentual de Aumento no Consumo (%):</label>
                    <input type="number" id="percentual-aumento" class="editable-field" value="0">
                </div>
            </div>
            
            <div class="form-group">
                <label for="consumo-dimensionamento">Consumo para dimensionamento (kWh):</label>
                <input type="number" id="consumo-dimensionamento" class="editable-field" value="1200" readonly>
            </div>
            
            <div class="action-buttons">
                <button class="btn" onclick="salvarInfoLead()">Salvar</button>
                <button class="btn btn-success" onclick="avancarParaCalculos()">Avançar para Cálculos</button>
            </div>
        </div>
        
        <!-- ABA CÁLCULOS -->
        <div id="calculos" class="tab-content">
            <h2>Cálculos de Geração</h2>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="quantidade-modulos">Quantidade de Módulos:</label>
                    <input type="number" id="quantidade-modulos" class="editable-field" value="12">
                </div>
                
                <div class="form-group">
                    <label for="potencia-modulo">Potência do Módulo (Wp):</label>
                    <input type="number" id="potencia-modulo" class="editable-field" value="700">
                </div>
            </div>
            
            <div class="form-group">
                <label for="area-modulo">Área por Módulo (m²):</label>
                <input type="number" id="area-modulo" class="editable-field" step="0.01" value="3.10">
            </div>
            
            <div class="result-box">
                <div class="result-item">
                    <span class="result-label">Potência Pico do Sistema Fotovoltaico (kW):</span>
                    <span class="result-value" id="potencia-sistema">8.4</span>
                </div>
                
                <div class="result-item">
                    <span class="result-label">Geração Média Mensal Estimada (kWh):</span>
                    <span class="result-value" id="geracao-media">1092</span>
                </div>
                
                <div class="result-item">
                    <span class="result-label">Área Mínima Necessária (m²):</span>
                    <span class="result-value" id="area-minima">37.2</span>
                </div>
                
                <div class="result-item">
                    <span class="result-label">Porcentagem da Geração vs Consumo:</span>
                    <span class="result-value" id="porcentagem-geracao">91%</span>
                </div>
            </div>
            
            <div id="status-geracao-container">
                <!-- Status da geração será inserido aqui dinamicamente -->
            </div>
            
            <div class="action-buttons">
                <button class="btn" onclick="calcularSistema()">Calcular</button>
                <button class="btn btn-success" onclick="avancarParaMateriais()">Avançar para Materiais</button>
            </div>
        </div>
        
        <!-- ABA MATERIAIS -->
        <div id="materiais" class="tab-content">
            <h2>Materiais do Sistema</h2>
            
            <div class="form-group">
                <label for="fornecedor">Fornecedor:</label>
                <input type="text" id="fornecedor" class="editable-field" placeholder="Digite o nome do fornecedor">
            </div>
            
            <h3>KIT FOTOVOLTAICO</h3>
            
            <button class="btn btn-sm add-item-btn" onclick="adicionarItemKit()">+ Adicionar Item</button>
            
            <table id="tabela-kit">
                <thead>
                    <tr>
                        <th class="descricao-item">Item</th>
                        <th class="quantidade-item">Quantidade</th>
                        <th class="unidade-item">Unidade</th>
                        <th class="preco-unitario-item">Preço Unitário (R$)</th>
                        <th class="preco-total-item">Preço Total (R$)</th>
                        <th class="acao-item">Ação</th>
                    </tr>
                </thead>
                <tbody id="materiais-kit-body">
                    <!-- Itens serão adicionados dinamicamente -->
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="4" style="text-align: right;"><strong>Total do Kit:</strong></td>
                        <td><strong id="total-kit" class="valor-real">R$ 0,00</strong></td>
                        <td></td>
                    </tr>
                </tfoot>
            </table>
            
            <h3>INFRAESTRUTURA ELÉTRICA</h3>
            
            <button class="btn btn-sm add-item-btn" onclick="adicionarItemInfraestrutura()">+ Adicionar Item</button>
            
            <table id="tabela-infraestrutura">
                <thead>
                    <tr>
                        <th class="descricao-item">Item</th>
                        <th class="quantidade-item">Quantidade</th>
                        <th class="unidade-item">Unidade</th>
                        <th class="preco-unitario-item">Preço Unitário (R$)</th>
                        <th class="preco-total-item">Preço Total (R$)</th>
                        <th class="acao-item">Ação</th>
                    </tr>
                </thead>
                <tbody id="infraestrutura-body">
                    <!-- Itens serão adicionados dinamicamente -->
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="4" style="text-align: right;"><strong>Total Infraestrutura:</strong></td>
                        <td><strong id="total-infraestrutura" class="valor-real">R$ 0,00</strong></td>
                        <td></td>
                    </tr>
                </tfoot>
            </table>
            
            <div class="result-box">
                <div class="result-item">
                    <span class="result-label">Total Geral dos Materiais:</span>
                    <span class="result-value valor-real" id="total-geral-materiais">R$ 0,00</span>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn" onclick="atualizarTotaisMateriais()">Atualizar Totais</button>
                <button class="btn btn-success" onclick="avancarParaAnaliseFinanceira()">Avançar para Análise Financeira</button>
            </div>
        </div>
        
        <!-- ABA ANÁLISE FINANCEIRA -->
        <div id="analise-financeira" class="tab-content">
            <h2>Análise Financeira</h2>
            
            <h3>CUSTOS OPERACIONAIS</h3>
            
            <button class="btn btn-sm add-item-btn" onclick="adicionarCusto()">+ Adicionar Custo</button>
            
            <table>
                <thead>
                    <tr>
                        <th>Item</th>
                        <th>Preço Unitário (R$)</th>
                        <th>Quantidade</th>
                        <th>Preço Total (R$)</th>
                        <th>Ação</th>
                    </tr>
                </thead>
                <tbody id="custos-body">
                    <!-- Custos serão adicionados dinamicamente -->
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="3" style="text-align: right;"><strong>Total de Custos Operacionais:</strong></td>
                        <td><strong id="total-custos" class="valor-real">R$ 0,00</strong></td>
                        <td></td>
                    </tr>
                </tfoot>
            </table>
            
            <h3>PARÂMETROS FINANCEIROS</h3>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="receita">Receita (%):</label>
                    <input type="number" id="receita" class="editable-field" step="0.01" value="23">
                </div>
                
                <div class="form-group">
                    <label for="comissao">Comissão (%):</label>
                    <input type="number" id="comissao" class="editable-field" step="0.01" value="5">
                </div>
                
                <div class="form-group">
                    <label for="imposto">Imposto (%):</label>
                    <input type="number" id="imposto" class="editable-field" step="0.01" value="5">
                </div>
            </div>
            
            <div class="result-box">
                <div class="result-item">
                    <span class="result-label">Custo com material (R$):</span>
                    <span class="result-value valor-real" id="custo-material">R$ 0,00</span>
                </div>
                
                <div class="result-item">
                    <span class="result-label">Custos operacionais (R$):</span>
                    <span class="result-value valor-real" id="custos-operacionais">R$ 0,00</span>
                </div>
                
                <div class="result-item">
                    <span class="result-label">Valor final da proposta (R$):</span>
                    <span class="result-value valor-real" id="valor-proposta">R$ 0,00</span>
                </div>
                
                <div class="result-item">
                    <span class="result-label">Comissão (R$):</span>
                    <span class="result-value valor-real" id="valor-comissao">R$ 0,00</span>
                </div>
                
                <div class="result-item">
                    <span class="result-label">Lucro bruto (R$):</span>
                    <span class="result-value valor-real" id="lucro-bruto">R$ 0,00</span>
                </div>
                
                <div class="result-item">
                    <span class="result-label">Lucro líquido (R$):</span>
                    <span class="result-value valor-real" id="lucro-liquido">R$ 0,00</span>
                </div>
                
                <!-- ADICIONANDO A RELAÇÃO R$/Wp NA ANÁLISE FINANCEIRA -->
                <div class="result-item">
                    <span class="result-label">Relação R$/Wp:</span>
                    <span class="result-value valor-real" id="relacao-wp-financeiro">R$ 0,00</span>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn" onclick="calcularAnaliseFinanceira()">Calcular</button>
                <button class="btn btn-success" onclick="avancarParaPropostaFinal()">Avançar para Proposta Final</button>
            </div>
        </div>
        
        <!-- ABA PROPOSTA FINAL -->
        <div id="proposta-final" class="tab-content">
            <!-- PÁGINA 1 - Informações do cliente e características do sistema -->
            <div class="proposta-pagina" id="pagina-1">
                <!-- Papel timbrado -->
                <div class="watermark" id="watermark-1"></div>
                
                <!-- Logo da empresa -->
                <div class="logo-empresa" id="logo-empresa-1">
                    <img src="data:image/png;base64,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" id="logo-image-1" >
                </div>
                
                <!-- Cabeçalho do PDF -->
                <div class="header-pdf">
                    <div class="header-content-pdf">
                        <h1>PROPOSTA COMERCIAL</h1>
                        <p>SISTEMA FOTOVOLTAICO</p>
                        <p>JouleLab - Soluções em Energia Solar</p>
                        <p><strong>Av. Rio Grande do Sul, 1345, Bairro dos Estados, Cep:58.030-020, João Pessoa-PB <br> CNPJ:39.970.300/0001-39</strong></p>
                    </div>
                </div>
                
                <div class="proposta-info">
                    <div class="modern-card">
                        <h4>INFORMAÇÕES DO CLIENTE</h4>
                        <p><strong>Cliente:</strong> <span id="proposta-cliente">nome</span></p>
                        <p><strong>CPF/CNPJ:</strong> <span id="proposta-cpf-cnpj">NI</span></p>
                        <p><strong>Cidade:</strong> <span id="proposta-cidade">RECIFE</span></p>
                        <p><strong>Estado:</strong> <span id="proposta-estado">PB</span></p>
                    </div>
                    <div class="modern-card">
                        <h4>DADOS DA PROPOSTA</h4>
                        <p><strong>Tecnologia:</strong> 
                            <select id="proposta-tecnologia" class="editable-field pdf-select" style="width: 120px; display: inline;">
                                <option value="String">String</option>
                                <option value="MLPE">MLPE</option>
                            </select>
                        </p>
                        <p><strong>Emissão:</strong> <span id="proposta-emissao">2025-11-10</span></p>
                        <p><strong>Controle:</strong> <span id="proposta-controle">1110-1-GD-MIC</span></p>
                        <p><strong>Emissor:</strong> Eng. Alexandre Gomes</p>
                    </div>
                </div>
                
                <div class="proposta-section">
                    <h3>CARACTERÍSTICAS DO SISTEMA</h3>
                    <div class="proposta-info">
                        <div class="modern-card">
                            <h4>ESPECIFICAÇÕES TÉCNICAS</h4>
                            <p><strong>Potência do Sistema Fotovoltaico:</strong> <span id="proposta-potencia">8.4</span> kWp</p>
                            <p><strong>Geração Média Mensal Estimada:</strong> <span id="proposta-geracao">1092</span> kWh</p>
                        </div>
                        <div class="modern-card">
                            <h4>COMPONENTES</h4>
                            <p><strong>Quantidade de Módulos Solar:</strong> <span id="proposta-modulos">12</span> Unid.</p>
                            <p><strong>Área Mínima Necessária:</strong> <span id="proposta-area">37.2</span> m²</p>
                        </div>
                    </div>
                </div>
                
                <div class="proposta-section">
                    <h3>INVESTIMENTO</h3>
                    <div class="result-box">
                        <div class="result-item">
                            <span class="result-label">Preço Total da Proposta:</span>
                            <span class="result-value valor-real" id="proposta-preco-total">R$ 0,00</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Relação R$/Wp:</span>
                            <span class="result-value valor-real" id="proposta-relacao">R$ 0,00</span>
                        </div>
                    </div>
                    
                    <!-- CALCULO DE PAYBACK ADICIONADO -->
                    <div class="payback-box" id="payback-container">
                        <h4>ANÁLISE DE PAYBACK</h4>
                        <div class="result-item">
                            <span class="result-label">Tempo de Retorno do Investimento:</span>
                            <span class="result-value valor-real" id="proposta-payback">0 anos</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Economia Anual Estimada:</span>
                            <span class="result-value valor-real" id="proposta-economia-anual">R$ 0,00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- PÁGINA 2 - Condições de pagamento e garantias -->
            <div class="proposta-pagina" id="pagina-2">
                <!-- Papel timbrado -->
                <div class="watermark" id="watermark-2"></div>
                
                <!-- Logo da empresa -->
                <div class="logo-empresa" id="logo-empresa-2">
                    <img src="data:image/png;base64,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" id="logo-image-2" >
                </div>
                
                <!-- Cabeçalho do PDF -->
                <div class="header-pdf">
                    <div class="header-content-pdf">
                        <h1>PROPOSTA COMERCIAL</h1>
                        <p>SISTEMA FOTOVOLTAICO</p>
                        <p>JouleLab - Soluções em Energia Solar</p>
                        <p><strong>Av. Rio Grande do Sul, 1345, Bairro dos Estados, Cep:58.030-020, João Pessoa-PB <br> CNPJ:39.970.300/0001-39</strong></p>
                    </div>
                </div>
                
                <div class="proposta-section">
                    <h3>CONDIÇÕES DE PAGAMENTO</h3>
                    <div class="proposta-info">
                        <div class="modern-card">
                            <p><strong>Financiamento:</strong> Até <input type="number" id="proposta-financiamento-parcelas" class="editable-field" value="60" style="width: 60px; display: inline;">x</p>
                            <p><strong>Cartão de Crédito:</strong> Até <input type="number" id="proposta-cartao-parcelas" class="editable-field" value="12" style="width: 60px; display: inline;">x</p>
                            <p><strong>À Vista:</strong> 
                                <input type="number" id="proposta-avista-1" class="editable-field" value="80" style="width: 55px; display: inline;">% - 
                                <input type="number" id="proposta-avista-2" class="editable-field" value="10" style="width: 55px; display: inline;">% - 
                                <input type="number" id="proposta-avista-3" class="editable-field" value="10" style="width: 55px; display: inline;">%
                            </p>
                        </div>
                    </div>
                </div>
                
                <div class="proposta-section">
                    <h3>PRAZOS DE IMPLANTAÇÃO</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Etapa</th>
                                <th>Prazo</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Visita Técnica</td>
                                <td><input type="number" id="proposta-visita-tecnica" class="editable-field" value="3" style="width: 50px; display: inline;"> Dias</td>
                            </tr>
                            <tr>
                                <td>Elaboração de Projeto</td>
                                <td><input type="number" id="proposta-elaboracao-projeto" class="editable-field" value="7" style="width: 50px; display: inline;"> Dias</td>
                            </tr>
                            <tr>
                                <td>Concessionária</td>
                                <td><input type="number" id="proposta-concessionaria" class="editable-field" value="20" style="width: 50px; display: inline;"> Dias</td>
                            </tr>
                            <tr>
                                <td>Instalação</td>
                                <td><input type="number" id="proposta-instalacao" class="editable-field" value="2" style="width: 50px; display: inline;"> Dias</td>
                            </tr>
                            <tr>
                                <td><strong>Tempo Total Médio de Implantação</strong></td>
                                <td><strong id="proposta-tempo-total">32</strong> Dias</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <!-- MENSAGEM DE ALERTA ADICIONADA -->
                    <div class="alerta-prazo">
                        <strong>ATENÇÃO:</strong> Caso a concessionária exija melhoria na rede elétrica, este prazo pode se alterar significativamente.
                    </div>
                </div>
                
                <div class="proposta-section">
                    <h3>GARANTIAS</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Componente</th>
                                <th>Garantia</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Instalação</td>
                                <td><input type="number" id="proposta-garantia-instalacao" class="editable-field" value="1" style="width: 60px; display: inline;"> Ano(s)</td>
                            </tr>
                            <tr>
                                <td>Inversor</td>
                                <td><input type="number" id="proposta-garantia-inversor" class="editable-field" value="10" style="width: 60px; display: inline;"> Anos</td>
                            </tr>
                            <tr>
                                <td>Módulo</td>
                                <td><input type="number" id="proposta-garantia-modulo" class="editable-field" value="12" style="width: 60px; display: inline;"> Anos</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- PÁGINA 3 - Materiais incluídos e rodapé -->
            <div class="proposta-pagina" id="pagina-3">
                <!-- Papel timbrado -->
                <div class="watermark" id="watermark-3"></div>
                
                <!-- Logo da empresa -->
                <div class="logo-empresa" id="logo-empresa-3">
                    <img src="data:image/png;base64,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" id="logo-image-3" >
                </div>
                
                <!-- Cabeçalho do PDF -->
                <div class="header-pdf">
                    <div class="header-content-pdf">
                        <h1>PROPOSTA COMERCIAL</h1>
                        <p>SISTEMA FOTOVOLTAICO</p>
                        <p>JouleLab - Soluções em Energia Solar</p>
                        <p><strong>Av. Rio Grande do Sul, 1345, Bairro dos Estados, Cep:58.030-020, João Pessoa-PB <br> CNPJ:39.970.300/0001-39</strong></p>
                    </div>
                </div>
                
                <div class="proposta-section">
                    <h3>MATERIAIS INCLUÍDOS</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Quantidade</th>
                                <th>Unidade</th>
                            </tr>
                        </thead>
                        <tbody id="proposta-materiais-body">
                            <!-- Os dados serão preenchidos via JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <div class="proposta-section">
                    <h3>SERVIÇOS INCLUÍDOS</h3>
                    <ol>
                        <li>Visita técnica antes, durante e após a instalação;</li>
                        <li>Elaboração de projeto (estudos, dimensionamentos e simulações);</li>
                        <li>Emissão de TRT (Termo de Responsabilidade Técnica) de projeto e execução;</li>
                        <li>Fornecimento de componentes e equipamentos (detalhados abaixo);</li>
                        <li>Transporte de todo material até o local da instalação;</li>
                        <li>Instalação do sistema fotovoltaico;</li>
                        <li>Comissionamento do sistema fotovoltaico segundo normas técnicas;</li>
                        <li>Fornecimento de toda documentação legal do sistema;</li>
                        <li>Acompanhamento de geração do sistema via internet;</li>
                        <li>Emissão de relatório mensal de geração.</li>
                    </ol>
                </div>

                <!-- Rodapé moderno com informações de contato -->
                <div class="contact-footer">
                    <h4>JouleLab - Energia que Transforma</h4>
                    <p>Soluções completas em energia solar fotovoltaica</p>
                    <div class="contact-info">
                        <div class="contact-item">
                            <span>📞</span>
                            <span>(81) 99521-2354</span>
                        </div>
                        <div class="contact-item">
                            <span>📧</span>
                            <span>portal@joule.eco.br</span>
                        </div>
                        <div class="contact-item">
                            <span>🌐</span>
                            <span>https://www.jouleenergiasolar.com.br</span>
                        </div>
                    </div>
                </div>
                
                <div class="footer">
                    <p>Proposta válida por 15 dias | Emitida em: <span id="proposta-data-emissao">2025-11-10</span></p>
                    <p>JouleLab Energia Solar © 2025 - Todos os direitos reservados</p>
                </div>
            </div>
            
            <!-- Controles de PDF -->
            <div class="pdf-controls">
                <button class="btn" onclick="atualizarProposta()">Atualizar Proposta</button>
                <button class="btn" onclick="gerarPDF(1)">Gerar PDF Página 1</button>
                <button class="btn" onclick="gerarPDF(2)">Gerar PDF Página 2</button>
                <button class="btn" onclick="gerarPDF(3)">Gerar PDF Página 3</button>
                <button class="btn btn-success" onclick="gerarPDFCompleto()">Gerar PDF Completo</button>
            </div>
        </div>
    </div>

    <script>
        // Sistema de persistência usando localStorage
        function obterControleData() {
            const hoje = new Date();
            const dataHoje = hoje.toISOString().split('T')[0];
            const dadosSalvos = localStorage.getItem('controleData');
            
            if (dadosSalvos) {
                const controleData = JSON.parse(dadosSalvos);
                // Se a data salva for diferente de hoje, resetar a sequência
                if (controleData.ultimaData !== dataHoje) {
                    return {
                        ultimaData: dataHoje,
                        sequencia: 0
                    };
                }
                return controleData;
            }
            
            return {
                ultimaData: dataHoje,
                sequencia: 0
            };
        }

        function salvarControleData(controleData) {
            localStorage.setItem('controleData', JSON.stringify(controleData));
        }

        // Inicialização da página
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    abrirTab(tabId);
                });
            });
            
            // Inicializar dados - IMPORTANTE: primeiro inicializar a data, depois gerar o controle
            inicializarData();
            gerarControle();
            inicializarInfoLead();
            inicializarMateriais();
            inicializarCustos();
            calcularSistema();
            calcularAnaliseFinanceira();
            atualizarProposta();
            
            // Configurar atualização automática
            configurarAtualizacaoAutomatica();
            
            // Adicionar evento para calcular consumo de dimensionamento
            document.getElementById('percentual-aumento').addEventListener('input', calcularConsumoDimensionamento);
            document.getElementById('consumo-medio').addEventListener('input', calcularConsumoDimensionamento);
            
            // Adicionar evento para calcular tempo total na proposta
            document.querySelectorAll('#proposta-final input[type="number"]').forEach(input => {
                if (input.id.includes('proposta-') && !input.id.includes('garantia')) {
                    input.addEventListener('input', calcularTempoTotalProposta);
                }
            });
            
            // Criar marca d'água para o papel timbrado
            criarMarcaDagua();
        });

        // Função para inicializar a data atual
        function inicializarData() {
            const hoje = new Date();
            const dataFormatada = hoje.toISOString().split('T')[0];
            const campoData = document.getElementById('data-emissao');
            campoData.value = dataFormatada;
        }

        // Função para gerar o código de controle automaticamente - CORRIGIDA
        function gerarControle() {
            const dataInput = document.getElementById('data-emissao').value;
            
            // Se não houver data selecionada, usar a data atual
            let data;
            if (!dataInput) {
                data = new Date();
                document.getElementById('data-emissao').value = data.toISOString().split('T')[0];
            } else {
                // CORREÇÃO: Criar data usando partes separadas para evitar problemas de UTC
                const [ano, mes, dia] = dataInput.split('-');
                data = new Date(parseInt(ano), parseInt(mes) - 1, parseInt(dia));
            }
            
            // CORREÇÃO: Usar métodos locais
            const mesCorrigido = String(data.getMonth() + 1).padStart(2, '0');
            const diaCorrigido = String(data.getDate()).padStart(2, '0');
            const mesDia = mesCorrigido + diaCorrigido;
            
            console.log('Data usada:', dataInput, 'Mês:', mesCorrigido, 'Dia:', diaCorrigido, 'MêsDia gerado:', mesDia);
            
            // Obter dados do controle
            let controleData = obterControleData();
            
            // Verificar se a data mudou
            if (controleData.ultimaData !== dataInput) {
                controleData.ultimaData = dataInput;
                controleData.sequencia = 0; // Resetar sequência para nova data
            }
            
            // Incrementar sequência
            controleData.sequencia++;
            
            // Salvar dados atualizados
            salvarControleData(controleData);
            
            // Gerar código de controle
            const controle = `${mesDia}-${controleData.sequencia}-GD-MIC`;
            document.getElementById('controle').value = controle;
            
            console.log('Controle gerado:', controle);
        }

        // Função para configurar atualização automática dos dados
        function configurarAtualizacaoAutomatica() {
            // Selecionar todos os campos da aba Info Lead que devem atualizar a proposta
            const camposInfoLead = [
                'empreendimento', 'cpf-cnpj', 'estado', 'data-emissao', 'controle',
                'cidade', 'projeto', 'modalidade'
            ];
            
            camposInfoLead.forEach(campoId => {
                const campo = document.getElementById(campoId);
                if (campo) {
                    campo.addEventListener('input', function() {
                        // Atualizar a proposta automaticamente quando o campo mudar
                        atualizarProposta();
                    });
                }
            });
            
            // Configurar também os campos de cálculo
            const camposCalculo = ['quantidade-modulos', 'potencia-modulo', 'area-modulo'];
            camposCalculo.forEach(campoId => {
                const campo = document.getElementById(campoId);
                if (campo) {
                    campo.addEventListener('input', function() {
                        calcularSistema();
                        atualizarProposta();
                    });
                }
            });
            
            // Configurar evento para atualizar controle quando a data mudar
            document.getElementById('data-emissao').addEventListener('change', function() {
                gerarControle();
                atualizarProposta();
            });
        }

        // Função para criar marca d'água
        function criarMarcaDagua() {
            // Criar marca d'água para cada página
            for (let i = 1; i <= 3; i++) {
                const watermark = document.getElementById(`watermark-${i}`);
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // Definir dimensões do canvas
                canvas.width = 800;
                canvas.height = 800;
                
                // Configurar estilo da marca d'água
                ctx.fillStyle = 'rgba(26, 82, 118, 0.03)';
                ctx.font = 'bold 100px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                // Rotacionar o texto
                ctx.translate(canvas.width / 2, canvas.height / 2);
                ctx.rotate(-Math.PI / 4);
                
                // Desenhar texto repetido
                for (let j = -5; j <= 5; j++) {
                    for (let k = -5; k <= 5; k++) {
                        ctx.fillText('JouleLab', j * 300, k * 150);
                    }
                }
                
                // Definir como background da marca d'água
                watermark.style.backgroundImage = `url(${canvas.toDataURL()})`;
                watermark.style.backgroundRepeat = 'repeat';
                watermark.style.backgroundSize = '400px 400px';
            }
        }

        // Funções para navegação entre abas
        function abrirTab(tabId) {
            // Esconder todas as abas
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.remove('active');
            });
            
            // Remover classe active de todas as tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Mostrar a aba selecionada
            document.getElementById(tabId).classList.add('active');
            
            // Ativar a tab correspondente
            document.querySelector(`.tab[data-tab="${tabId}"]`).classList.add('active');
        }
        
        function avancarParaCalculos() {
            salvarInfoLead();
            abrirTab('calculos');
        }
        
        function avancarParaMateriais() {
            abrirTab('materiais');
        }
        
        function avancarParaAnaliseFinanceira() {
            abrirTab('analise-financeira');
        }
        
        function avancarParaPropostaFinal() {
            // Recalcular tudo antes de mostrar a proposta
            calcularSistema();
            calcularAnaliseFinanceira();
            atualizarProposta();
            abrirTab('proposta-final');
        }

        // Funções da aba INFO LEAD
        function inicializarInfoLead() {
            calcularConsumoDimensionamento();
        }
        
        function calcularConsumoDimensionamento() {
            const consumoMedio = parseFloat(document.getElementById('consumo-medio').value) || 0;
            const percentualAumento = parseFloat(document.getElementById('percentual-aumento').value) || 0;
            
            const consumoDimensionamento = consumoMedio + (consumoMedio * percentualAumento / 100);
            document.getElementById('consumo-dimensionamento').value = consumoDimensionamento.toFixed(2);
        }
        
        function salvarInfoLead() {
            // Aqui você pode implementar a lógica para salvar os dados
            console.log("Dados do lead salvos");
        }

        // Funções da aba CÁLCULOS
        function calcularSistema() {
            const quantidadeModulos = parseFloat(document.getElementById('quantidade-modulos').value) || 0;
            const potenciaModulo = parseFloat(document.getElementById('potencia-modulo').value) || 0;
            const areaModulo = parseFloat(document.getElementById('area-modulo').value) || 0;
            
            // Cálculo da potência do sistema
            const potenciaSistema = (quantidadeModulos * potenciaModulo) / 1000;
            document.getElementById('potencia-sistema').textContent = potenciaSistema.toFixed(2);
            
            // Cálculo da geração média (simplificado)
            const geracaoMedia = potenciaSistema * 130; // 130 é uma constante de geração
            document.getElementById('geracao-media').textContent = geracaoMedia.toFixed(0);
            
            // Cálculo da área mínima
            const areaMinima = quantidadeModulos * areaModulo;
            document.getElementById('area-minima').textContent = areaMinima.toFixed(1);
            
            // Calcular porcentagem da geração vs consumo
            const consumoDimensionamento = parseFloat(document.getElementById('consumo-dimensionamento').value) || 0;
            let porcentagem = 0;
            
            if (consumoDimensionamento > 0) {
                porcentagem = (geracaoMedia / consumoDimensionamento) * 100;
            }
            
            document.getElementById('porcentagem-geracao').textContent = porcentagem.toFixed(0) + '%';
            
            // Verificar status da geração
            verificarStatusGeracao(geracaoMedia, consumoDimensionamento, porcentagem);
            
            // Atualizar quantidade de módulos nos materiais e custos
            atualizarQuantidadeModulos(quantidadeModulos);
        }
        
        function verificarStatusGeracao(geracaoMedia, consumoDimensionamento, porcentagem) {
            const container = document.getElementById('status-geracao-container');
            container.innerHTML = '';
            
            const statusDiv = document.createElement('div');
            statusDiv.className = 'status-geracao';
            
            if (geracaoMedia < consumoDimensionamento) {
                statusDiv.classList.add('status-alerta');
                statusDiv.innerHTML = `
                    <strong>ATENÇÃO:</strong> A geração média estimada (${geracaoMedia.toFixed(0)} kWh) 
                    está <strong>${(100 - porcentagem).toFixed(0)}% abaixo</strong> do consumo de dimensionamento 
                    (${consumoDimensionamento.toFixed(0)} kWh).
                `;
            } else {
                statusDiv.classList.add('status-ok');
                statusDiv.innerHTML = `
                    <strong>OK:</strong> A geração média estimada (${geracaoMedia.toFixed(0)} kWh) 
                    está <strong>${porcentagem.toFixed(0)}%</strong> do consumo de dimensionamento 
                    (${consumoDimensionamento.toFixed(0)} kWh).
                `;
            }
            
            container.appendChild(statusDiv);
        }

        // Funções da aba MATERIAIS
        function inicializarMateriais() {
            // Adicionar itens fixos do kit fotovoltaico
            adicionarItemKit("MODULO FOTOVOLTAICO", 12, "Unid.", 0);
            adicionarItemKit("INVERSOR FOTOVOLTAICO", 1, "Unid.", 0);
            adicionarItemKit("CABO SOLAR", 50, "m", 0);
            adicionarItemKit("ESTRUTURA METALICA", 1, "Unid", 0);
            adicionarItemKit("KIT", 1, "Unid", 0);
            
            // Adicionar item fixo da infraestrutura elétrica
            adicionarItemInfraestrutura("Eletrodutos, cabos, disjuntores", 1, "Unid.", 650);
            
            atualizarTotaisMateriais();
        }
        
        function atualizarQuantidadeModulos(quantidade) {
            // Atualizar quantidade de módulos na aba Materiais
            const linhasKit = document.querySelectorAll('#materiais-kit-body tr');
            linhasKit.forEach(linha => {
                const descricaoInput = linha.querySelector('td:first-child input');
                if (descricaoInput && descricaoInput.value.toUpperCase().includes('MODULO FOTOVOLTAICO')) {
                    const quantidadeInput = linha.querySelector('td:nth-child(2) input');
                    if (quantidadeInput) {
                        quantidadeInput.value = quantidade;
                        // Disparar evento para recalcular preço total
                        const event = new Event('input', { bubbles: true });
                        quantidadeInput.dispatchEvent(event);
                    }
                }
            });
            
            // Atualizar quantidade de mão de obra na aba Análise Financeira
            const linhasCustos = document.querySelectorAll('#custos-body tr');
            linhasCustos.forEach(linha => {
                const descricaoInput = linha.querySelector('td:first-child input');
                if (descricaoInput && descricaoInput.value.toUpperCase().includes('MÃO DE OBRA')) {
                    const quantidadeInput = linha.querySelector('td:nth-child(3) input');
                    if (quantidadeInput) {
                        quantidadeInput.value = quantidade;
                        // Disparar evento para recalcular preço total
                        const event = new Event('input', { bubbles: true });
                        quantidadeInput.dispatchEvent(event);
                    }
                }
            });
        }
        
        function adicionarItemKit(descricao = "", quantidade = 1, unidade = "Unid.", precoUnitario = 0) {
            const tbody = document.getElementById('materiais-kit-body');
            const novaLinha = document.createElement('tr');
            novaLinha.innerHTML = `
                <td><input type="text" class="editable-field" value="${descricao}" placeholder="Descrição do item"></td>
                <td><input type="number" class="editable-field" value="${quantidade}" min="1"></td>
                <td><input type="text" class="editable-field" value="${unidade}"></td>
                <td><input type="number" class="editable-field" step="0.01" value="${precoUnitario}"></td>
                <td class="preco-total">${formatarMoeda(quantidade * precoUnitario)}</td>
                <td><button class="btn btn-sm btn-danger" onclick="removerLinha(this)">Remover</button></td>
            `;
            tbody.appendChild(novaLinha);
            
            // Adicionar eventos para calcular preço total
            const inputs = novaLinha.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                input.addEventListener('input', calcularPrecoTotalLinha);
            });
            
            atualizarTotaisMateriais();
        }
        
        function adicionarItemInfraestrutura(descricao = "", quantidade = 1, unidade = "Unid.", precoUnitario = 0) {
            const tbody = document.getElementById('infraestrutura-body');
            const novaLinha = document.createElement('tr');
            novaLinha.innerHTML = `
                <td><input type="text" class="editable-field" value="${descricao}" placeholder="Descrição do item"></td>
                <td><input type="number" class="editable-field" value="${quantidade}" min="1"></td>
                <td><input type="text" class="editable-field" value="${unidade}"></td>
                <td><input type="number" class="editable-field" step="0.01" value="${precoUnitario}"></td>
                <td class="preco-total">${formatarMoeda(quantidade * precoUnitario)}</td>
                <td><button class="btn btn-sm btn-danger" onclick="removerLinha(this)">Remover</button></td>
            `;
            tbody.appendChild(novaLinha);
            
            // Adicionar eventos para calcular preço total
            const inputs = novaLinha.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                input.addEventListener('input', calcularPrecoTotalLinha);
            });
            
            atualizarTotaisMateriais();
        }
        
        function removerLinha(botao) {
            const linha = botao.closest('tr');
            linha.remove();
            atualizarTotaisMateriais();
        }
        
        function calcularPrecoTotalLinha(event) {
            const linha = event.target.closest('tr');
            const quantidade = parseFloat(linha.querySelector('td:nth-child(2) input').value) || 0;
            const precoUnitario = parseFloat(linha.querySelector('td:nth-child(4) input').value) || 0;
            const precoTotal = quantidade * precoUnitario;
            
            linha.querySelector('.preco-total').textContent = formatarMoeda(precoTotal);
            
            atualizarTotaisMateriais();
        }
        
        function atualizarTotaisMateriais() {
            // Calcular total do kit
            let totalKit = 0;
            const linhasKit = document.querySelectorAll('#materiais-kit-body tr');
            linhasKit.forEach(linha => {
                const precoTotal = parseFloat(linha.querySelector('.preco-total').textContent.replace('R$ ', '').replace('.', '').replace(',', '.')) || 0;
                totalKit += precoTotal;
            });
            
            document.getElementById('total-kit').textContent = formatarMoeda(totalKit);
            
            // Calcular total da infraestrutura
            let totalInfraestrutura = 0;
            const linhasInfraestrutura = document.querySelectorAll('#infraestrutura-body tr');
            linhasInfraestrutura.forEach(linha => {
                const precoTotal = parseFloat(linha.querySelector('.preco-total').textContent.replace('R$ ', '').replace('.', '').replace(',', '.')) || 0;
                totalInfraestrutura += precoTotal;
            });
            
            document.getElementById('total-infraestrutura').textContent = formatarMoeda(totalInfraestrutura);
            
            // Calcular total geral
            const totalGeral = totalKit + totalInfraestrutura;
            document.getElementById('total-geral-materiais').textContent = formatarMoeda(totalGeral);
        }

        // Funções da aba ANÁLISE FINANCEIRA
        function inicializarCustos() {
            // Adicionar custos fixos
            const quantidadeModulos = parseFloat(document.getElementById('quantidade-modulos').value) || 12;
            
            adicionarCusto("Engenharia", 364, 1);
            adicionarCusto("Obra Civil", 0, 1);
            adicionarCusto("Mão de Obra", 100, quantidadeModulos);
            
            atualizarTotaisCustos();
        }
        
        function adicionarCusto(descricao = "", precoUnitario = 0, quantidade = 1) {
            const tbody = document.getElementById('custos-body');
            const novaLinha = document.createElement('tr');
            novaLinha.innerHTML = `
                <td><input type="text" class="editable-field" value="${descricao}" placeholder="Descrição do custo"></td>
                <td><input type="number" class="editable-field" step="0.01" value="${precoUnitario}"></td>
                <td><input type="number" class="editable-field" value="${quantidade}" min="1"></td>
                <td class="custo-preco-total">${formatarMoeda(quantidade * precoUnitario)}</td>
                <td><button class="btn btn-sm btn-danger" onclick="removerLinha(this)">Remover</button></td>
            `;
            tbody.appendChild(novaLinha);
            
            // Adicionar eventos para calcular preço total
            const inputs = novaLinha.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                input.addEventListener('input', calcularPrecoTotalCusto);
            });
            
            atualizarTotaisCustos();
        }
        
        function calcularPrecoTotalCusto(event) {
            const linha = event.target.closest('tr');
            const quantidade = parseFloat(linha.querySelector('td:nth-child(3) input').value) || 0;
            const precoUnitario = parseFloat(linha.querySelector('td:nth-child(2) input').value) || 0;
            const precoTotal = quantidade * precoUnitario;
            
            linha.querySelector('.custo-preco-total').textContent = formatarMoeda(precoTotal);
            
            atualizarTotaisCustos();
        }
        
        function atualizarTotaisCustos() {
            let totalCustos = 0;
            const linhasCustos = document.querySelectorAll('#custos-body tr');
            linhasCustos.forEach(linha => {
                const precoTotal = parseFloat(linha.querySelector('.custo-preco-total').textContent.replace('R$ ', '').replace('.', '').replace(',', '.')) || 0;
                totalCustos += precoTotal;
            });
            
            document.getElementById('total-custos').textContent = formatarMoeda(totalCustos);
        }
        
        function calcularAnaliseFinanceira() {
            // Dados de entrada
            const receita = parseFloat(document.getElementById('receita').value) || 0;
            const comissao = parseFloat(document.getElementById('comissao').value) || 0;
            const imposto = parseFloat(document.getElementById('imposto').value) || 0;
            
            // Cálculo de custos
            const custosOperacionais = parseFloat(document.getElementById('total-custos').textContent.replace('R$ ', '').replace('.', '').replace(',', '.')) || 0;
            const custoMaterial = parseFloat(document.getElementById('total-geral-materiais').textContent.replace('R$ ', '').replace('.', '').replace(',', '.')) || 0;
            
            // Cálculo do valor da proposta
            const valorProposta = (custosOperacionais + custoMaterial) * (1 + receita / 100);
            
            // Cálculo da comissão
            const valorComissao = valorProposta * (comissao / 100);
            
            // Cálculo do lucro bruto
            const lucroBruto = valorProposta - custosOperacionais - custoMaterial - valorComissao;
            
            // Cálculo do lucro líquido
            const lucroLiquido = lucroBruto * (1 - imposto / 100);
            
            // Cálculo da relação R$/Wp
            const potenciaSistema = parseFloat(document.getElementById('potencia-sistema').textContent) || 0;
            let relacaoWp = 0;
            if (potenciaSistema > 0) {
                relacaoWp = valorProposta / (potenciaSistema * 1000);
            }
            
            // Atualizar resultados
            document.getElementById('custos-operacionais').textContent = formatarMoeda(custosOperacionais);
            document.getElementById('custo-material').textContent = formatarMoeda(custoMaterial);
            document.getElementById('valor-proposta').textContent = formatarMoeda(valorProposta);
            document.getElementById('valor-comissao').textContent = formatarMoeda(valorComissao);
            document.getElementById('lucro-bruto').textContent = formatarMoeda(lucroBruto);
            document.getElementById('lucro-liquido').textContent = formatarMoeda(lucroLiquido);
            document.getElementById('relacao-wp-financeiro').textContent = formatarMoeda(relacaoWp);
        }

        // Funções da aba PROPOSTA FINAL
        function atualizarProposta() {
            // Atualizar informações do cliente
            document.getElementById('proposta-cliente').textContent = document.getElementById('empreendimento').value;
            document.getElementById('proposta-cpf-cnpj').textContent = document.getElementById('cpf-cnpj').value;
            document.getElementById('proposta-cidade').textContent = document.getElementById('cidade').value;
            document.getElementById('proposta-estado').textContent = document.getElementById('estado').value;
            document.getElementById('proposta-emissao').textContent = document.getElementById('data-emissao').value;
            document.getElementById('proposta-controle').textContent = document.getElementById('controle').value;
            
            // Atualizar características do sistema
            document.getElementById('proposta-potencia').textContent = document.getElementById('potencia-sistema').textContent;
            document.getElementById('proposta-geracao').textContent = document.getElementById('geracao-media').textContent;
            document.getElementById('proposta-modulos').textContent = document.getElementById('quantidade-modulos').value;
            document.getElementById('proposta-area').textContent = document.getElementById('area-minima').textContent;
            
            // Atualizar investimento
            const valorProposta = parseFloat(document.getElementById('valor-proposta').textContent.replace('R$ ', '').replace('.', '').replace(',', '.')) || 0;
            const potenciaSistema = parseFloat(document.getElementById('potencia-sistema').textContent) || 0;
            
            document.getElementById('proposta-preco-total').textContent = formatarMoeda(valorProposta);
            
            // Calcular relação R$/Wp corretamente
            if (potenciaSistema > 0) {
                const relacaoWp = valorProposta / (potenciaSistema * 1000);
                document.getElementById('proposta-relacao').textContent = formatarMoeda(relacaoWp);
            } else {
                document.getElementById('proposta-relacao').textContent = formatarMoeda(0);
            }
            
            // Calcular payback
            calcularPayback();
            
            // Atualizar materiais incluídos
            const propostaMateriaisBody = document.getElementById('proposta-materiais-body');
            propostaMateriaisBody.innerHTML = '';
            
            // Adicionar itens do kit
            const linhasKit = document.querySelectorAll('#materiais-kit-body tr');
            linhasKit.forEach(linha => {
                const descricao = linha.querySelector('td:first-child input').value;
                const quantidade = linha.querySelector('td:nth-child(2) input').value;
                const unidade = linha.querySelector('td:nth-child(3) input').value;
                
                if (descricao) {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${descricao}</td>
                        <td>${quantidade}</td>
                        <td>${unidade}</td>
                    `;
                    propostaMateriaisBody.appendChild(tr);
                }
            });
            
            // Adicionar itens da infraestrutura
            const linhasInfraestrutura = document.querySelectorAll('#infraestrutura-body tr');
            linhasInfraestrutura.forEach(linha => {
                const descricao = linha.querySelector('td:first-child input').value;
                const quantidade = linha.querySelector('td:nth-child(2) input').value;
                const unidade = linha.querySelector('td:nth-child(3) input').value;
                
                if (descricao) {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${descricao}</td>
                        <td>${quantidade}</td>
                        <td>${unidade}</td>
                    `;
                    propostaMateriaisBody.appendChild(tr);
                }
            });
            
            // Atualizar data de emissão no rodapé também
            document.getElementById('proposta-data-emissao').textContent = document.getElementById('data-emissao').value;
            
            // Calcular tempo total
            calcularTempoTotalProposta();
        }
        
        function calcularPayback() {
            const valorProposta = parseFloat(document.getElementById('valor-proposta').textContent.replace('R$ ', '').replace('.', '').replace(',', '.')) || 0;
            const geracaoMedia = parseFloat(document.getElementById('geracao-media').textContent) || 0;
            
            // Supondo um valor médio de R$ 0,80 por kWh (ajuste conforme necessário)
            const valorKwh = 0.80;
            const economiaMensal = geracaoMedia * valorKwh;
            const economiaAnual = economiaMensal * 12;
            
            let paybackAnos = 0;
            if (economiaAnual > 0) {
                paybackAnos = valorProposta / economiaAnual;
            }
            
            document.getElementById('proposta-economia-anual').textContent = formatarMoeda(economiaAnual);
            document.getElementById('proposta-payback').textContent = paybackAnos.toFixed(1) + ' anos';
        }
        
        function calcularTempoTotalProposta() {
            const visitaTecnica = parseInt(document.getElementById('proposta-visita-tecnica').value) || 0;
            const elaboracaoProjeto = parseInt(document.getElementById('proposta-elaboracao-projeto').value) || 0;
            const concessionaria = parseInt(document.getElementById('proposta-concessionaria').value) || 0;
            const instalacao = parseInt(document.getElementById('proposta-instalacao').value) || 0;
            
            const tempoTotal = visitaTecnica + elaboracaoProjeto + concessionaria + instalacao;
            document.getElementById('proposta-tempo-total').textContent = tempoTotal;
        }
        
        // Função para gerar PDF de uma página específica
        function gerarPDF(pagina) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');
            const element = document.getElementById(`pagina-${pagina}`);
            
            // Fazer uma cópia do elemento para manipulação
            const elementClone = element.cloneNode(true);
            
            // Remover todos os inputs e substituir por seus valores
            const inputs = elementClone.querySelectorAll('input');
            inputs.forEach(input => {
                const span = document.createElement('span');
                span.textContent = input.value;
                span.style.marginLeft = '5px';
                span.style.fontWeight = 'normal';
                span.style.backgroundColor = 'transparent';
                input.parentNode.replaceChild(span, input);
            });
            
            // Remover a classe de fundo rosa dos selects
            const selects = elementClone.querySelectorAll('select');
            selects.forEach(select => {
                select.classList.remove('editable-field');
                select.classList.add('pdf-select');
                select.style.backgroundColor = 'white';
                select.style.border = '1px solid #ddd';
                select.style.color = '#333';
            });
            
            // Adicionar o clone temporariamente ao documento
            elementClone.style.position = 'absolute';
            elementClone.style.left = '-9999px';
            elementClone.style.width = '210mm'; // Largura A4
            elementClone.style.padding = '15mm'; // Margens
            document.body.appendChild(elementClone);
            
            // Configurações do html2canvas
            html2canvas(elementClone, {
                scale: 2,
                useCORS: true,
                allowTaint: true,
                logging: false,
                width: elementClone.scrollWidth,
                height: elementClone.scrollHeight,
                windowWidth: elementClone.scrollWidth,
                windowHeight: elementClone.scrollHeight
            }).then(canvas => {
                // Remover o clone
                document.body.removeChild(elementClone);
                
                const imgData = canvas.toDataURL('image/png');
                const imgWidth = 210; // Largura A4 em mm
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                
                // Adicionar a imagem ao PDF
                doc.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
                
                doc.save(`proposta_pagina_${pagina}.pdf`);
            }).catch(error => {
                console.error('Erro ao gerar PDF:', error);
                // Remover o clone em caso de erro
                if (document.body.contains(elementClone)) {
                    document.body.removeChild(elementClone);
                }
                alert('Erro ao gerar PDF. Tente novamente.');
            });
        }
        
        // Função para gerar PDF completo (todas as páginas)
        function gerarPDFCompleto() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');
            
            // Array para armazenar as promessas de conversão de cada página
            const promises = [];
            
            // Para cada página, criar uma promessa de conversão
            for (let i = 1; i <= 3; i++) {
                const element = document.getElementById(`pagina-${i}`);
                
                // Fazer uma cópia do elemento para manipulação
                const elementClone = element.cloneNode(true);
                
                // Remover todos os inputs e substituir por seus valores
                const inputs = elementClone.querySelectorAll('input');
                inputs.forEach(input => {
                    const span = document.createElement('span');
                    span.textContent = input.value;
                    span.style.marginLeft = '5px';
                    span.style.fontWeight = 'normal';
                    span.style.backgroundColor = 'transparent';
                    input.parentNode.replaceChild(span, input);
                });
                
                // Remover a classe de fundo rosa dos selects
                const selects = elementClone.querySelectorAll('select');
                selects.forEach(select => {
                    select.classList.remove('editable-field');
                    select.classList.add('pdf-select');
                    select.style.backgroundColor = 'white';
                    select.style.border = '1px solid #ddd';
                    select.style.color = '#333';
                });
                
                // Adicionar o clone temporariamente ao documento
                elementClone.style.position = 'absolute';
                elementClone.style.left = '-9999px';
                elementClone.style.width = '210mm'; // Largura A4
                elementClone.style.padding = '15mm'; // Margens
                document.body.appendChild(elementClone);
                
                // Criar uma promessa para cada página
                const promise = html2canvas(elementClone, {
                    scale: 2,
                    useCORS: true,
                    allowTaint: true,
                    logging: false,
                    width: elementClone.scrollWidth,
                    height: elementClone.scrollHeight,
                    windowWidth: elementClone.scrollWidth,
                    windowHeight: elementClone.scrollHeight
                }).then(canvas => {
                    // Remover o clone
                    document.body.removeChild(elementClone);
                    
                    return canvas.toDataURL('image/png');
                }).catch(error => {
                    console.error(`Erro ao gerar página ${i}:`, error);
                    // Remover o clone em caso de erro
                    if (document.body.contains(elementClone)) {
                        document.body.removeChild(elementClone);
                    }
                    throw error;
                });
                
                promises.push(promise);
            }
            
            // Quando todas as páginas estiverem prontas, criar o PDF
            Promise.all(promises)
                .then(images => {
                    // Adicionar cada imagem como uma página no PDF
                    images.forEach((imgData, index) => {
                        if (index > 0) {
                            doc.addPage();
                        }
                        
                        const imgWidth = 210; // Largura A4 em mm
                        const imgHeight = (doc.internal.pageSize.height * imgWidth) / doc.internal.pageSize.width;
                        
                        doc.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
                    });
                    
                    doc.save('proposta_completa.pdf');
                })
                .catch(error => {
                    console.error('Erro ao gerar PDF completo:', error);
                    alert('Erro ao gerar PDF completo. Tente novamente.');
                });
        }
        
        // Funções auxiliares
        function formatarMoeda(valor) {
            return 'R$ ' + valor.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }
    </script>
</body>
</html>
